{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "alarm_card",
    "name" : "Alarm card",
    "deprecated" : false,
    "image" : "tb-image:YWxlcnRfY2FydC5wbmc=:YWxlcnRfY2FydC5wbmc=:SU1BR0U=;data:image/png;base64,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",
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 7,
      "sizeY" : 3.5,
      "resources" : [ ],
      "templateHtml" : "<div class=\"card\">\n    <div fxLayout=\"row\" fxLayoutGap=\"15px\" fxLayoutAlign=\"space-between\">\n        <div fxLayout=\"column\">\n            <div class=\"status\" fxLayout=\"column\">\n                <h3>{{label}}</h3>\n                <h1>\n                    {{value}}\n                </h1>\n            </div>\n        </div>\n        <div class=\"circle\"\n            style=\"background-color: {{iconBackground}}; color: {{iconColor}}\">\n           <mat-icon>{{icon}}</mat-icon>\n        </div>\n    </div>\n    <div *ngIf=\"displayTimeUpdated\" fxLayout=\"row\" fxLayoutAlign=\"space-between\">\n        <div fxLayout=\"row\" fxLayoutGap=\"15px\" style=\"flex-basis:100%\">\n            <div class=\"updated\" fxLayout=\"row\">\n                <mat-icon>history</mat-icon>\n                <h4>\n                    Updated {{timeUpdated}}\n                </h4>\n            </div>\n        </div>\n    </div>\n    \n</div>",
      "templateCss" : ".card {\n   width: 100%;\n   height: 100%;\n   color: #344054;\n   display: flex;\n   flex-direction: column;\n   justify-content: space-between;\n}\n\n.card .content {\n   padding: 20px;\n   display: flex;\n   flex-direction: row;\n   align-items: center;\n   justify-content: flex-start;\n   height: 100%;\n   width: 100%;\n   box-sizing: border-box;\n}\n\n.card .content .column {\n   display: flex;\n   flex-direction: column;    \n   justify-content: space-around;\n   height: 100%;\n}\n\n.card h2{\n    font-size: 20px;\n    font-weight: 600;\n    margin: 3px 0;\n    line-height: 26px;\n}\n\n.card h3{\n    font-size: 14px;\n    font-weight: 400;\n    margin: 5px 0;\n    line-height: 18px;\n    color: #344054;\n}\n\n.card h1{\n    display: flex;\n    align-items: baseline;\n    font-size: 24px;\n    font-weight: 600;\n    line-height: 24px;\n    margin: 0;\n    gap: 5px;\n}\n\n.card h1 .unit{\n    font-size: 18px;\n    font-weight: 400;\n    color: #344054;\n}\n\n.card .comfort{\n    font-size: 20px;\n    line-height: 28px;\n}\n\n.card h4{\n    font-size: 14px;\n    font-weight: 400;\n    margin: 5px 0;\n    line-height: 20px;\n    color: #667085;\n}\n\n.card .status{\n    flex-basis: 50%;\n}\n\n.card .updated{\n    color: #667085;\n    align-items: center;\n    gap: 8px;\n}\n\n.card .percent{\n    color: #42af58;\n    vertical-align: super;\n    font-weight: 500;\n    font-size: 24px;\n    height: 100%;\n}\n\n.card .value {\n    font-size: 28px;\n    font-weight: 600;\n}\n\n.card .description {\n    font-size: 14px;\n    margin-top: 7px;\n}\n\n.circle{\n    height: 45px;\n    width: 45px;\n    background-color: #FFF2F1;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    color: #FF3B30;\n    justify-content: center;\n    margin: 5px 0;\n}\n",
      "controllerScript" : "let settings, entityId, http, isRealEntity;\n\nself.onInit = function() {\n    let utils = self.ctx.$scope.$injector.get(self.ctx.servicesMap.get('utils'));\n    http = self.ctx.$scope.$injector.get(self.ctx.servicesMap.get('http')); \n    entityId = self.ctx.datasources ? self.ctx.datasources[0].entity.id : {};\n    isRealEntity = self.ctx.datasources && self.ctx.datasources[0].type=='entity';\n    settings = utils.deepClone(self.ctx.settings) || {};\n    self.ctx.$scope.units = self.ctx.units;\n    \n    self.ctx.$scope.label = settings.title;\n    self.ctx.$scope.value = 0;\n    self.ctx.$scope.timeUpdated = moment().fromNow();  \n    self.ctx.$scope.displayTimeUpdated = settings.displayTimeUpdated;\n    \n    self.ctx.$scope.icon = settings['icon'];\n    self.ctx.$scope.iconColor = settings['iconColor'] || '#FFF2F1'; \n    self.ctx.$scope.iconBackground = settings['iconBackground'] || '#FF3B30'; \n}\n\nself.onDataUpdated = function() {\n    self.ctx.$scope.value = 0;\n    \n    if(isRealEntity){\n        fetchAllAlarms().subscribe(response=>{\n            if(response.totalElements){\n                self.ctx.$scope.value = response.totalElements\n                self.ctx.detectChanges();\n                if(response.data){\n                    self.ctx.$scope.timeUpdated = moment(response.data[0].createdTime).fromNow();  \n                }\n            }\n        });\n    }\n}\n\nfunction fetchAllAlarms(pageSize=100, page=0){\n    return http.get(`/api/v2/alarm/${entityId.entityType}/${entityId.id}?statusList=ACTIVE%2CUNACK&pageSize=${pageSize}&page=${page}`).pipe(\n        self.ctx.rxjs.switchMap((data) => {\n\t\t    if (data.hasNext) {\n\t\t\t\treturn fetchAllAlarms(pageSize, page + 1).pipe(self.ctx.rxjs.map((resp) => ({ data: [...data.data, ...resp.data] })));\n\t\t\t}\n\t\t\treturn self.ctx.rxjs.of(data);\n\t\t})\n\t);\n}\n\nself.typeParameters = function() {\n    return {\n        maxDataKeys: 1,\n        singleEntity: true,\n        dataKeysOptional: true,\n        ignoreDataUpdateOnIntervalTick: true\n    };\n}\n\n\nself.actionSources = function() {\n    return {\n        'elementClick': {\n            name: 'widget-action.element-click',\n            multiple: true\n        }\n    };\n}",
      "settingsSchema" : "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"properties\": {\n            \"title\": {\n                \"title\": \"Title\",\n                \"type\": \"string\",\n                \"default\": \"Alerts\"\n            },\n            \"icon\": {\n                \"title\": \"Icon\",\n                \"type\": \"string\"\n            },\n            \"iconColor\": {\n                \"title\": \"Icon color\",\n                \"type\": \"string\"\n            },\n            \"iconBackground\": {\n                \"title\": \"Icon background\",\n                \"type\": \"string\"\n            },\n            \"displayTimeUpdated\": {\n                \"title\": \"Display Last Updated Time\",\n                \"type\": \"boolean\",\n                \"default\": true\n            }\n        },\n        \"required\": []\n    },\n    \"form\": [\n        [\n            \"title\",\n            {\n                \"key\": \"icon\",\n                \"type\": \"icon\"\n            },\n            {\n                \"key\": \"iconColor\",\n                \"type\": \"color\"\n            },\n            {\n                \"key\": \"iconBackground\",\n                \"type\": \"color\"\n            },\n            \"displayTimeUpdated\"\n        ]\n    ],\n    \"groupInfoes\": [\n        {\n            \"formIndex\": 0,\n            \"GroupTitle\": \"Icon settings\"\n        }\n    ]\n}\n\n",
      "dataKeySettingsSchema" : "{\n  \"schema\": {\n      \"type\": \"object\",\n      \"title\": \"Data key settings\",\n      \"properties\": {\n          \"columnWidth\": {\n              \"title\": \"Column width (px or %)\",\n              \"type\": \"string\",\n              \"format\": \"regex\",\n              \"pattern\": \"^\\\\d+(px|%)$\"\n          }\n      }\n  },\n  \"form\": [\"columnWidth\"]\n}",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Sin\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.8502823114921272,\"funcBody\":\"return Math.round(1000*Math.sin(time/5000));\",\"aggregationType\":null,\"units\":\"mm\",\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null}],\"alarmFilterConfig\":{\"statusList\":[\"ACTIVE\"]}}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"#FFFFFF\",\"color\":\"#384250\",\"padding\":\"18px\",\"settings\":{\"iconColor\":\"#b42318\",\"iconBackground\":\"#fee4e2\",\"icon\":\"warning\",\"displayTimeUpdated\":true,\"title\":\"Alerts\"},\"title\":\"Alarm card\",\"dropShadow\":false,\"enableFullscreen\":false,\"enableDataExport\":false,\"widgetStyle\":{\"border\":\"1px solid #D0D5DD\"},\"widgetCss\":\"\",\"pageSize\":1024,\"noDataDisplayMessage\":\"\",\"borderRadius\":\"8px\",\"actions\":{\"headerButton\":[],\"elementClick\":[{\"name\":\"navigate\",\"icon\":\"arrow_forward\",\"useShowWidgetActionFunction\":null,\"showWidgetActionFunction\":\"return true;\",\"type\":\"openDashboardState\",\"targetDashboardStateId\":\"default\",\"setEntityId\":true,\"stateEntityParamName\":null,\"openRightLayout\":false,\"openInSeparateDialog\":false,\"openInPopover\":false,\"id\":\"59053a80-1d82-d085-cb1e-852cbf6916fa\"},{\"name\":\"edit\",\"icon\":\"mode_edit\",\"useShowWidgetActionFunction\":null,\"showWidgetActionFunction\":\"return true;\",\"type\":\"custom\",\"customFunction\":null,\"openInSeparateDialog\":false,\"openInPopover\":false,\"id\":\"5da0c79e-a924-6ac2-976c-d5dec0e1e1c7\"},{\"name\":\"delete\",\"icon\":\"delete\",\"useShowWidgetActionFunction\":null,\"showWidgetActionFunction\":\"return true;\",\"type\":\"custom\",\"customFunction\":null,\"openInSeparateDialog\":false,\"openInPopover\":false,\"id\":\"23ce0371-e90d-8c5a-996f-06bfbf5b63ce\"}]},\"units\":null,\"useDashboardTimewindow\":true,\"displayTimewindow\":true}"
    },
    "externalId" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "35c1e790-b251-11ef-8c91-7baf5304b8d0"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}